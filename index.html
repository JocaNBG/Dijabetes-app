<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dnevnik glukoze v5.5</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <h1>Dnevnik glukoze v5.5</h1>
    <p class="subtitle">Period + doba dana (više izbora) · Interaktivni grafik · Statistike i modal sa dnevnim podacima</p>
  </header>

  <section class="form-section">
    <h2>➕ Novi unos</h2>
    <div class="form-row">
      <input type="date" id="date" />
      <input type="time" id="time" />
      <input type="number" id="glucose" placeholder="Glukoza (mmol/L)" step="0.1" />
    </div>

    <div class="form-row">
      <select id="commentSelect" onchange="commentChanged()">
        <option value="">-- Odaberi komentar --</option>
        <option value="jutarnji">🌅 Jutarnji šećer</option>
        <option value="dorucak">🍳 1–2h posle doručka</option>
        <option value="rucak">🍽️ 1–2h posle ručka</option>
        <option value="vecera">🌙 1–2h posle večere</option>
        <option value="predvecera">🥣 Pre večere</option>
        <option value="trening">🏃‍♂️ Posle treninga</option>
        <option value="lekovi">💊 Posle terapije</option>
        <option value="custom">✍️ Slobodan unos</option>
      </select>
      <input type="text" id="comment" placeholder="Komentar" style="display:none;" />
    </div>

    <div class="form-row">
      <label>Obrok / navike:</label>
      <span class="emoji-select">
        <label><input type="checkbox" value="🥚" />🥚</label>
        <label><input type="checkbox" value="🐟" />🐟</label>
        <label><input type="checkbox" value="🍖" />🍖</label>
        <label><input type="checkbox" value="🍞" />🍞</label>
        <label><input type="checkbox" value="☕" />☕</label>
        <label><input type="checkbox" value="🥗" />🥗</label>
        <label><input type="checkbox" value="🍷" />🍷</label>
      </span>
    </div>

    <div class="form-row">
      <button onclick="addEntry()">➕ Sačuvaj unos</button>
    </div>
  </section>

  <section class="filter-section">
    <h2>🔎 Filteri</h2>
    <div class="form-row">
      <div class="filter-block">
        <label for="startDate">Početak</label>
        <input type="date" id="startDate" />
      </div>
      <div class="filter-block">
        <label for="endDate">Kraj</label>
        <input type="date" id="endDate" />
      </div>
      <div class="filter-block">
        <label>Doba dana (više izbora)</label>
        <div class="zone-multi">
          <label><input type="checkbox" id="z-jutro" checked /> 🌄 Jutro</label>
          <label><input type="checkbox" id="z-prepodne" checked /> 🌤️ Pre podne</label>
          <label><input type="checkbox" id="z-podne" checked /> ☀️ Podne</label>
          <label><input type="checkbox" id="z-vece" checked /> 🌇 Veče</label>
          <label><input type="checkbox" id="z-noc" checked /> 🌙 Noć</label>
        </div>
      </div>
    </div>
    <div class="form-row">
      <button onclick="applyDateFilters()">✅ Primeni</button>
      <button onclick="resetFilter()">🔄 Poništi</button>
      <div class="presets">
        <button onclick="presetDays(1)">Danas</button>
        <button onclick="presetDays(7)">7 dana</button>
        <button onclick="presetDays(30)">30 dana</button>
        <button onclick="presetDays(0)">Sve</button>
      </div>
    </div>
  </section>

  <section class="stats-section">
    <h2>📊 Statistika (po filtru)</h2>
    <div id="stats" class="stats-cards"></div>
  </section>

  <section class="chart-section">
    <h2>📈 Grafik</h2>
    <canvas id="glucoseChart" height="120"></canvas>
  </section>

  <section class="table-section">
    <h2>📜 Dnevnik</h2>
    <table id="logTable">
      <thead>
        <tr>
          <th>Datum</th>
          <th>Vreme</th>
          <th>Glukoza</th>
          <th>Komentar</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <section class="action-buttons">
    <input type="file" id="fileInput" />
    <button onclick="importCSV()">📥 Import CSV</button>
    <button onclick="exportCSV()">📤 Export CSV</button>
    <button onclick="clearAll()">🧹 Obriši sve</button>
  </section>

  <!-- Modal for Daily Data -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h3 id="modalTitle">Detalji za dan</h3>
      <div id="zoneStats" class="zone-stats"></div>
      <canvas id="dayChart" height="100"></canvas>
      <ul id="dayEntries"></ul>
    </div>
  </div>

  <script src="app.js"></script>
  <script src="modal.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js').catch(console.error);
      });
    }
  </script>
</body>
</html>
